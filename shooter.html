<html>
  <head>
    <title>Shooter</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    
    <a href="./index.html">
  <button type="button" class="back_btn">Back</button>
      </a>
    
    <br>
    
    <canvas id="canvas" height="650" width="650"></canvas>
    
    <script>
      
      //SET UP
      var rightB = 0
      var leftB = 0
      var upB = 0
      var downB = 0
      var frameCounter = 0
      var walkingMod = 0
      var eSXV
      var eSYV
      var eSWV
      var eSHV
      var pauseTimer = 0
      var pause = false
      var immunityCounter = 0
      var commandFrameCounter = 0
      var frame = 0
      var c = document.getElementById("canvas");
      var ctx = c.getContext("2d");
      
      
      var background_img = new Image();
      background_img.src = "grassyArea.png"
     
      var background = {
       sX: 0,
       sY: 0,
       sWidth: 900,
       sHeight: 900,
       x: 0,
       y: 0,
       width: 650,
       height: 650, 
       draw: function () {     
      ctx.drawImage(background_img, this.sX, this.sY, this.sWidth, this.sHeight, this.x, this.y, this.width, this.height)  
      }
      }
      
      
      //ARROW KEYS and CONTROLLER
    
 var controller = {

  left:false,
  right:false,
  up:false,
  down:false,
  leftAttack: false,
  rightAttack: false,
  upAttack: false,
  downAttack: false, 
  t: false,
  y: false,
  esc: false,
      
  keyListener:function(event) {

    var key_state = (event.type == "keydown")?true:false;

    switch(event.keyCode) {

      
      case 65:// A
        controller.left = key_state;
      break;
      case 87:// W
        controller.up = key_state;
      break;
      case 68:// D
        controller.right = key_state;
      break;
      case 83:// S
        controller.down = key_state;
      break;
      case 37:// left arrow
        controller.leftAttack = key_state;
      break;
      case 38:// up arrow
        controller.upAttack = key_state;
      break;
      case 39:// right arrow
        controller.rightAttack = key_state;
      break;
      case 40:// down arrow
        controller.downAttack = key_state;
      break;   
      case 84://t
        controller.t = key_state;
      break;  
      case 89://y
        controller.y = key_state;
      break; 
      case 27: //esc
        controller.esc = key_state;
      break;  

    }

  }

};
     
      
      
      //PLAYER 
      
      
      var player_img = new Image();
      player_img.src = "https://kawaii.kawaii.at/img/solid-red-fabric-Robert-Kaufman-USA-Red-179485-1.JPG"
      
    var player = {
      speedCost: 0,
      bulletSpeedCost: 0,
      money: 0,
      health: 10,
      height: 50,
      width: 50,
      x_speed: 0,
      y_speed: 0,
      x: 650/2,
      y: 650/2,
      enemySpawnSpeed: 1,
      enemySpawnCounter: 0,
      attackSpeed: 1,
      attackCounter: 0,
      speedBoost: 0,
      draw: function() {
      ctx.drawImage(player_img, this.x, this.y, this.width, this.height)
      }
    }
    
    //BULLET
    
    var bulletList = {} 
       
    
      function Bullet(id,x,y,x_speed,y_speed) {
        
        var bullet_img = new Image();
      bullet_img.src = "bullet.png"
      
      var bullet = {
       x_speed: x_speed,
       y_speed: y_speed, 
       height: 20,
       width:20,
       x: x,
       y: y,
       id: id, 
       draw: function() { 
        ctx.drawImage(bullet_img, this.x, this.y, this.width, this.height)
       }
      }
     
     bulletList[id] = bullet;
        
        
      }
      
 //ENEMY     
      
      var enemyList = {} 
       
    
      function Enemy(id, x, y, x_speed, y_speed, width, height) {
        
        var enemy_img = new Image();
      enemy_img.src = "blueEnemy.png"
      
      var enemy = { 
       x_speed: x_speed,
       y_speed: y_speed,
       sX: 0,
       sY: 0,
       sHeight: 241,
       sWidth: 952, 
       height: height,
       width: width,
       x: x,
       y: y,
       id: id,
       draw: function() { 
        ctx.drawImage(enemy_img, this.sX, this.sY, this.sWidth, this.sHeight, this.x, this.y, this.width, this.height)
       }
      }
     
     enemyList[id] = enemy;
        
        
      }
      
      //COllISION FUNCTION
      
     function entityDistance(entity1,entity2){
       
      var vx = (entity1.x + (entity1.width/2)) - (entity2.x + (entity2.width/2))
      var vy = (entity1.y + (entity1.height/2))  - (entity2.y + (entity2.height/2))
      return Math.sqrt(vx*vx+vy*vy); 
       
     }
      
      function testEntityCollision(entity1,entity2){
       var distance = entityDistance(entity1,entity2);
        return distance < 25
        
      }
      
    
 //UPDATE FUNCTION
      
      function update() {
        
       ctx.clearRect(0, 0, 650, 650);
        updateBackground();
        playerUpdate();
        generateBullet();
        generateEnemy();
        frame++
        frameCounter += 0.2
        walkingMod = frameCounter % 3
     
        if (controller.esc && pause === false) {
         if (pauseTimer > 1){
         pause = true
           console.log('paused')
            pauseTimer = 0
          }
        }
        
        
        if (controller.esc && pause) {
          if (pauseTimer > 1){
         pause = false
            console.log('play')
            pauseTimer = 0
          }
        }
        
        if (frame % 1 === 0){
         player.attackCounter += player.attackSpeed
         player.enemySpawnCounter += player.enemySpawnSpeed
        }
        
        if (frame % 20 === 0){ 
         commandFrameCounter++
         immunityCounter++ 
        }
        
        if (frame % 10 === 0) {
    
        }
        
        if (frame % 47 === 0) {   // this should be about 1 second
          pauseTimer++
        }
        
        if (frame % 470 === 0) {  //10 seconds 
         player.enemySpawnSpeed++;
         
        }
          
        
        for (var key in enemyList){        
         enemyUpdate(enemyList[key]) 
          
           var isColliding = testEntityCollision(player, enemyList[key])
        if (isColliding) { 
          if (immunityCounter > 3) {
           player.health -= 1
            playerHitSound();
            immunityCounter = 0;
          }
          
        }
          
        }
        
        for (var key in bulletList){        
         bulletUpdate(bulletList[key]) 
          
           for (var key2 in enemyList){ 
             
             var isColliding = testEntityCollision(bulletList[key], enemyList[key2])
        if (isColliding) {       
         delete bulletList[key]
          delete enemyList[key2]
          player.money += 100;     
             
        }  
           }  
        }  
      }
      
      function bulletUpdate(something) {
       
        something.x += something.x_speed;
        something.y += something.y_speed;
        something.draw();
        
   
      }
      
      function enemyUpdate(something) {
       
        if (player.x > something.x) { //enemy is going right 
          something.x += something.x_speed
        }
        
         if (player.x < something.x) { //enemy is going left
         something.x -= something.x_speed
        }
        
         if (player.y > something.y) { //enemy is doing down
           something.y += something.y_speed
        }
        
         if (player.y < something.y) { //enemy is going up
         something.y -= something.y_speed  
        }
        
        if (player.x > something.x) { //enemy is going right   
          if ((player.x - something.x) > Math.abs(player.y - something.y)){
         something.sX = 492
         something.sY = 4
         something.sWidth = 210
         something.sHeight = 240
            if (walkingMod >= 2) {
         something.sX = 493
         something.sY = 241
         something.sWidth = 188
         something.sHeight = 236 
            }
        }
        }
        if (player.x < something.x) { //enemy is going left
          if ((something.x - player.x) > Math.abs(player.y - something.y)){
         something.sX = 274
         something.sY = 3
         something.sWidth = 208
         something.sHeight = 237 
                 if (walkingMod >= 2) {
         something.sX = 272
         something.sY = 241
         something.sWidth = 188
         something.sHeight = 236 
            }
        } 
        }
          if (player.y > something.y) { //enemy is doing down
            if ((player.y - something.y) > Math.abs(player.x - something.x)) {
         something.sX = 13
         something.sY = 27
         something.sWidth = 229
         something.sHeight = 218 
              if (walkingMod >= 2) {
         something.sX = 6
         something.sY = 263
         something.sWidth = 233
         something.sHeight = 227 
            }
        }      
        } 
        if (player.y < something.y) { //enemy is going up  
          if ((something.y - player.y) > Math.abs(player.x - something.x)) {
         something.sX = 723
         something.sY = 22
         something.sWidth = 229
         something.sHeight = 219 
            if (walkingMod >= 2) {
         something.sX = 714
         something.sY = 266
         something.sWidth = 226
         something.sHeight = 223 
            }
          }
        }
        
        something.draw();
       
      }
      
       
      
      
      function generateEnemy() {
        if (player.enemySpawnCounter > 300){  
        var x_speed = (Math.random() + 0.5) * 2   
        var y_speed = x_speed
        var x = Math.random() * 650;
        var y = Math.random() * 650;
        var width = 50;
        var height = 50;
        var id = Math.random(); 
        Enemy(id, x, y, x_speed, y_speed, width, height)
        player.enemySpawnCounter = 0
        }     
      }
    
      //GENERATE BULLET
      
      function generateBullet() {
        
         
       if (controller.upAttack && controller.downAttack === false && controller.leftAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
         var x_speed = 0
       var y_speed = -5
       var x = player.x + 20
       var y = player.y - 5
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
         player.attackCounter = 0;
       }
        }
        
           if (controller.downAttack && controller.upAttack === false && controller.leftAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = 0
       var y_speed = 5
       var x = player.x + 20
       var y = player.y + 40
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
          player.attackCounter = 0;
       }
        }
        
           if (controller.rightAttack && controller.downAttack === false && controller.leftAttack === false && controller.upAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = 5
       var y_speed = 0
       var x = player.x + 40
       var y = player.y + 20
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
              player.attackCounter = 0;
       }
        }
        
           if (controller.leftAttack && controller.downAttack === false && controller.upAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = -5
       var y_speed = 0
       var x = player.x - 5
       var y = player.y + 20
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed);
       player.attackCounter = 0;
       }
        }
        
      }
      
      //START OVER
      
      function startOver() {
       player.x = 650/2
       player.y = 650/2     
       player.enemySpawnSpeed = 1
       player.bulletSpeedCost = 0
       player.speedCost = 0 
       
         for (var key in bulletList){       
              delete bulletList[key] }
        
        for (var key in enemyList){       
              delete enemyList[key] }
        
        
       player.health = 10  
      }
      
      //PLAYER UPDATE
      
      function playerUpdate() {
        
    
        
        
        if (player.health <= 0) {
         startOver(); 
        }
        
        if (controller.t === true && controller.y === true) {
          if (commandFrameCounter > 10){
         var command = prompt("Put command here:")
         commandFrameCounter = 0;
         controller.t = false  
         controller.y = false   
       
       switch(command) {
        
           case 'IBS':
               player.attackSpeed *= 2;
           break;
           case 'IPS':
               player.speedBoost += 0.5;
           break;
         default:
           confirm('sorry, that is not a command');     
       }}   
       }
        
       
        
        
        if (controller.up) {
          player.y_speed += (-0.5 - player.speedBoost)
        }
        
         if (controller.down) {       
            player.y_speed += (0.5 + player.speedBoost)           
        }
        
         if (controller.left) {      
            player.x_speed += (-0.5 - player.speedBoost) 
        }
        
         if (controller.right) {          
            player.x_speed += (0.5 + player.speedBoost)        
        }
        
     
       
        player.x += player.x_speed;
        player.y += player.y_speed;
        player.x_speed *= 0.9;
        player.y_speed *= 0.9;
        
        
        player.draw();
        ctx.font = "30px Arial";
        ctx.fillStyle = "#000000";
        ctx.fillText(player.health + " Hp",0,30)
        ctx.fillText("$" + player.money,230,30)
        
      }
      //UPDATE BACKGROUND
      
      function updateBackground() {
  var rightB = 600
  var leftB = 50
  var upB = 50 
  var downB = 600
  
  if ((player.x + player.width) >= rightB) {
   background.sX += ((player.x + player.width) - rightB) 
   player.x -= ((player.x + player.width) - rightB)  
  }
        
    if (player.x <= leftB) {
   background.sX -= (leftB - player.x) 
   player.x += (leftB - player.x) 
   for (key in enemyList) { enemyList[key].x += 100 
                          console.log('this ran')}
  }
        
   if ((player.y + player.height) >= downB) {
   background.sY += ((player.y + player.height) - downB) 
   player.y -= ((player.y + player.height) - downB) 
  }
        
        if (player.y <= upB) {
   background.sY -= (upB - player.y) 
   player.y += (upB - player.y) 
  }
        background.draw();
      }
     
      //AUDIO FUNCTIONS
      
     var ouch_audio = document.createElement("audio");
     ouch_audio.src = "ouch.mp3";
      
      function playerHitSound() {
      
      }
     
      
      //SHOP FUNCTIONS
      
      
       function increaseBulletSpeed(){
        if(player.money >= (1000 + player.bulletSpeedCost)){
          player.attackSpeed++
          player.money -= (1000 + player.bulletSpeedCost)
          player.bulletSpeedCost += 200;
       }
       }
      
      function increasePlayerSpeed(){
        if(player.money >= (1000 + player.speedCost)){
          player.speedBoost += 0.05
          player.money -= (1000 + player.speedCost)
           player.bulletSpeedCost += 200;
       }
       }
      
      setInterval(function() { update()}, 20); 
     
                    
    
      window.addEventListener("keydown", controller.keyListener)
      window.addEventListener("keyup", controller.keyListener);
      
    </script>
    
    <html>
      <br>
      <button  onclick="increasePlayerSpeed()">Increase Player Speed</button>
       <button onclick="increaseBulletSpeed()">Increase Bullet Speed</button>
      
      
      
      </html>
  </body>
</html>
