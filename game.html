<html>
  <head>
    <title>PLACEHOLDER</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    
    <a href="./index.html">
  <button type="button" class="back_btn">Back</button>
      </a>
    
    <br>
    
    <canvas id="canvas" height="650" width="650"></canvas>
    
    <script>
      
      //SET UP
      var immunityCounter = 0
      var commandFrameCounter = 0
      var frame = 0
      var c = document.getElementById("canvas");
      var ctx = c.getContext("2d");
     
      function drawCanvas() {
        
      ctx.fillStyle = "#cccccc";
      ctx.fillRect(0, 0, 650, 650);
        
      }
      
      
      
      //ARROW KEYS and CONTROLLER
    
 var controller = {

  left:false,
  right:false,
  up:false,
  down:false,
  leftAttack: false,
  rightAttack: false,
  upAttack: false,
  downAttack: false, 
  t: false,
  y: false, 
      
  keyListener:function(event) {

    var key_state = (event.type == "keydown")?true:false;

    switch(event.keyCode) {

      
      case 65:// A
        controller.left = key_state;
      break;
      case 87:// W
        controller.up = key_state;
      break;
      case 68:// D
        controller.right = key_state;
      break;
      case 83:// S
        controller.down = key_state;
      break;
      case 37:// left arrow
        controller.leftAttack = key_state;
      break;
      case 38:// up arrow
        controller.upAttack = key_state;
      break;
      case 39:// right arrow
        controller.rightAttack = key_state;
      break;
      case 40:// down arrow
        controller.downAttack = key_state;
      break;   
      case 84://t
        controller.t = key_state;
      break;  
      case 89://y
        controller.y = key_state;
      break;    

    }

  }

};
     
      
      
      //PLAYER 
      
      
      var player_img = new Image();
      player_img.src = "https://kawaii.kawaii.at/img/solid-red-fabric-Robert-Kaufman-USA-Red-179485-1.JPG"
      
    var player = {
      money: 0,
      health: 10,
      height: 30,
      width: 30,
      x_speed: 0,
      y_speed: 0,
      x: 650/2,
      y: 650/2,
      enemySpawnSpeed: 1,
      enemySpawnCounter: 0,
      attackSpeed: 1,
      attackCounter: 0,
      speedBoost: 0,
      draw: function() {
      ctx.drawImage(player_img, this.x, this.y, this.width, this.height)
      }
    }
    
    //BULLET
    
    var bulletList = {} 
       
    
      function Bullet(id,x,y,x_speed,y_speed) {
        
        var bullet_img = new Image();
      bullet_img.src = "https://cdn.static-economist.com/sites/default/files/images/2014/06/blogs/babbage/20140628_stp501.jpg"
      
      var bullet = {
       x_speed: x_speed,
       y_speed: y_speed, 
       height: 10,
       width:10,
       x: x,
       y: y,
       id: id, 
       draw: function() { 
        ctx.drawImage(bullet_img, this.x, this.y, this.width, this.height)
       }
      }
     
     bulletList[id] = bullet;
        
        
      }
      
 //ENEMY     
      
      var enemyList = {} 
       
    
      function Enemy(id,x,y,x_speed,y_speed, width, height) {
        
        var enemy_img = new Image();
      enemy_img.src = "https://www.solidbackgrounds.com/images/2560x1440/2560x1440-blue-solid-color-background.jpg"
      
      var enemy = {
       x_speed: x_speed,
       y_speed: y_speed, 
       height: width,
       width: width,
       x: x,
       y: y,
       id: id, 
       draw: function() { 
        ctx.drawImage(enemy_img, this.x, this.y, this.width, this.height)
       }
      }
     
     enemyList[id] = enemy;
        
        
      }
      
      //COllISION FUNCTION
      
     function entityDistance(entity1,entity2){
       
      var vx = entity1.x - entity2.x;
      var vy = entity1.y - entity2.y;
      return Math.sqrt(vx*vx+vy*vy); 
       
     }
      
      function testEntityCollision(entity1,entity2){
       var distance = entityDistance(entity1,entity2);
        return distance < 20
        
      }
      
    
 //UPDATE FUNCTION
      
      function update() {
        
       ctx.clearRect(0, 0, 650, 650);
        drawCanvas();
        playerUpdate();
        generateBullet();
        generateEnemy();
        frame++
        
        
        if (frame % 1 === 0){
         player.attackCounter += player.attackSpeed
         player.enemySpawnCounter += player.enemySpawnSpeed
        }
        
        if (frame % 20 === 0){ 
         commandFrameCounter++
         immunityCounter++ 
        }
        
        if (frame % 47 === 0) {   // this should be about 1 second
          
        }
        
        if (frame % 470 === 0) {  //10 seconds 
         player.enemySpawnSpeed++;
         
        }
          
        
        for (var key in enemyList){        
         enemyUpdate(enemyList[key]) 
          
           var isColliding = testEntityCollision(player, enemyList[key])
        if (isColliding) { 
          if (immunityCounter > 3) {
           player.health -= 1
            immunityCounter = 0;
          }
          
        }
          
        }
        
        for (var key in bulletList){        
         bulletUpdate(bulletList[key]) 
          
           for (var key2 in enemyList){ 
             
             var isColliding = testEntityCollision(bulletList[key], enemyList[key2])
        if (isColliding) {       
         delete bulletList[key]
          delete enemyList[key2]
          player.money += 100;
        
        }
            
             
           }
          
        }
    
      }
      
      function bulletUpdate(something) {
       
        something.x += something.x_speed;
        something.y += something.y_speed;
        something.draw();
        
   
      }
      
      function enemyUpdate(something) {
       
        if (player.x > something.x) {
         something.x += something.x_speed 
        }
        
         if (player.x < something.x) {
         something.x -= something.x_speed 
        }
        
         if (player.y > something.y) {
         something.y += something.y_speed 
        }
        
         if (player.y < something.y) {
         something.y -= something.y_speed 
        }
        
        something.draw();
       
      }
      
      
      function generateEnemy() {
        if (player.enemySpawnCounter > 300){
        var x_speed = (Math.random() + 0.5) * 2   
        var y_speed = x_speed
        var x = Math.random() * 650;
        var y = Math.random() * 650;
        var width = 20;
        var height = 20;
        var id = Math.random(); 
        Enemy(id,x,y,x_speed,y_speed, width, height);
        player.enemySpawnCounter = 0
        }     
      }
    
      //GENERATE BULLET
      
      function generateBullet() {
        
         
       if (controller.upAttack && controller.downAttack === false && controller.leftAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
         var x_speed = 0
       var y_speed = -5
       var x = player.x + 10
       var y = player.y - 5
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
         player.attackCounter = 0;
       }
        }
        
           if (controller.downAttack && controller.upAttack === false && controller.leftAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = 0
       var y_speed = 5
       var x = player.x + 10
       var y = player.y + 25
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
          player.attackCounter = 0;
       }
        }
        
           if (controller.rightAttack && controller.downAttack === false && controller.leftAttack === false && controller.upAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = 5
       var y_speed = 0
       var x = player.x + 25
       var y = player.y + 10
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed); 
              player.attackCounter = 0;
       }
        }
        
           if (controller.leftAttack && controller.downAttack === false && controller.upAttack === false && controller.rightAttack === false) {
       if (player.attackCounter > 30){
             var x_speed = -5
       var y_speed = 0
       var x = player.x - 5
       var y = player.y + 10
       var id = Math.random();
       Bullet(id, x, y, x_speed, y_speed);
       player.attackCounter = 0;
       }
        }
        
      }
      
      //START OVER
      
      function startOver() {
       player.x = 650/2
       player.y = 650/2     
       player.speedBoost = 0
       player.enemySpawnSpeed = 1
       player.attackSpeed = 1
       
         for (var key in bulletList){       
              delete bulletList[key] }
        
        for (var key in enemyList){       
              delete enemyList[key] }
        
        
       player.health = 10  
      }
      
      //PLAYER UPDATE
      
      function playerUpdate() {
        
        
        if (player.health <= 0) {
         startOver(); 
        }
        
        if (controller.t === true && controller.y === true) {
          if (commandFrameCounter > 10){
         var command = prompt("Put command here:")
         commandFrameCounter = 0;
         controller.t = false  
         controller.y = false   
       
       switch(command) {
        
           case 'IBS':
               player.attackSpeed *= 2;
           break;
           case 'IPS':
               player.speedBoost += 0.5;
           break;
         default:
           confirm('sorry, that is not a command');     
       }}   
       }
        
       
        
        
        if (controller.up) {
          player.y_speed += (-0.5 - player.speedBoost)
        }
        
         if (controller.down) {       
            player.y_speed += (0.5 + player.speedBoost)           
        }
        
         if (controller.left) {      
            player.x_speed += (-0.5 - player.speedBoost) 
        }
        
         if (controller.right) {          
            player.x_speed += (0.5 + player.speedBoost)        
        }
        
     
       
        player.x += player.x_speed;
        player.y += player.y_speed;
        player.x_speed *= 0.9;
        player.y_speed *= 0.9;
        
        
        player.draw();
        ctx.font = "30px Arial";
        ctx.fillStyle = "#000000";
        ctx.fillText(player.health + " Hp",0,30)
        ctx.fillText("$" + player.money,230,30)
        
      }
      
       setInterval(function() { update()}, 20); 
     
                    
    
      window.addEventListener("keydown", controller.keyListener)
      window.addEventListener("keyup", controller.keyListener);
      
    </script>
  </body>
</html>
