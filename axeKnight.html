<html>
<head>
<title>Axe Knight</title>
</head>
 <body>
 <a href="./index.html">Homepage</a>
 <br>
<canvas id="canvas" style="background:#000"></canvas> 
  
<script>
 
 //SET UP
 var animation, controller;
 var canvas = document.getElementById('canvas')
 var c = canvas.getContext('2d');
 var innerWidth = 1420;
 var innerHeight = 775; 
 canvas.width = innerWidth;
 canvas.height = innerHeight;
 
 
 //AVATARS SET UP
 
//ENEMY
 
 var enemy_height = 50;
 var enemy_width = 50;
 var enemy_image = new Image();
 enemy_image.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Solid_blue.svg/225px-Solid_blue.svg.png';
  
 var enemy = {
   gravity: true,
   x: 25,
   y: 775 - 20 - 50,
   damage: 10,
   health: 30,
   x_velocity: 0,
   y_velocity: 0,
   height: enemy_height,
   width: enemy_width,
   draw: function() {
   c.drawImage(enemy_image, this.x, this.y, this.width, this.height);
  }}
 
  //PLAYER
 var slash_image = new Image();
 slash_image.src = 'slash.png'
 var player_height = 100;
 var player_width = 100;
 var player_image = new Image();
 player_image.src = 'http://sohme.com/wp-content/uploads/2015/07/red.png';
 
  var player = { 
   imunityLength: 100,
   imunity: false,
   gravity: true,
   face: 'right',
   dash: false,
   damage: 10,
  health: 100,
  jumping: false,
  x_velocity: 0,
  y_velocity: 0, 
  height: player_height,
  width: player_width,
  x: innerWidth/2 - player_width/2,
  x_end: this.x + 100,
  y: innerHeight - (player_height + 100),
  draw: function() {
  c.drawImage(player_image, this.x, this.y, this.width, this.height);
 }
 };
 
 
 
 //CONTROLLER
controller = {
 up: false,
 left: false,
 right: false, 
 attack: false,
 dash: false,
 heal: false,
 keyListener: function(event) {
  
  var key_state = (event.type == 'keydown')?true:false;
 
  switch(event.keyCode) {
   case 37: controller.left = key_state;
    break;
   case 39: controller.right = key_state;
    break;
   case 90: controller.up = key_state;
    break; 
   case 88: controller.attack = key_state;
    break;
   case 67: controller.dash = key_state;
    break;
   case 65: controller.heal = key_state;
  } 
  }  
  }
 
 //PLAYER ANIMATION

 animation = function() {
  
 if (controller.attack && player.face === 'right') {
  c.drawImage(slash_image, player.x + 120, player.y, 50, 100)
 }
  
  
  
  
  /* if (controller.dash && player.dash === false){
  if (player.face === 'right') 
  {
   player.dash = true;
   dashRight();
   setTimeout(waitDashRight, 750) 
   function waitDashRight() {
 player.dash = false;
  }}
   
   if (player.face === 'left')
   {
    player.dash = true;
    dashLeft();
    setTimeout(waitDashLeft, 750)
    function waitDashLeft() {
 player.dash = false;
   }}
  } */
  
  
  
  if (player.jumping === false && controller.up) {
   player.y_velocity -= 80;
   player.jumping = true; 
  }
  
  
  if (controller.left) {
 if (player.x <= 20) {
 player.x_velocity = 0;
  player.face = 'left';
 } else {
   player.x_velocity -= 1.2;
   player.face = 'left';
 }}
 
 if (controller.right) {
  if (player.x >= 1300) {
   player.x_velocity = 0;
   player.face = 'right';
  } else {
  player.x_velocity += 1.2;
player.face = 'right';
 }} 
 
player.y_velocity += 5;
player.x += player.x_velocity;
player.y += player.y_velocity; 

  if (player.gravity === true) {
  player.x_velocity *= 0.9;
player.y_velocity *= 0.9;
  }
  
if (player.y > 775 - 20 - 100) {
  player.jumping = false;
  player.y = 775 - 20 - 100; 
  player.y_velocity = 0; 
}

  
  //ENEMY ANIMATION
  
  
  if(player.x > enemy.x){
   enemy.x_velocity += 0.8
  }
  if (player.x < enemy.x){
   enemy.x_velocity -= 0.8
  }
  if (player.x === enemy.x){
   enemy.x_velocity = 0
  }
  
  if (enemy.x >= 1300) {
   enemy.x_velocity = 0;
   enemy.x -= 2; 
  }
  
   if (enemy.x <= 20) {
   enemy.x_velocity = 0;
   enemy.x += 2; 
  }
  
enemy.x += enemy.x_velocity;

  if (enemy.gravity === true) {
  enemy.x_velocity *= 0.9;
enemy.y_velocity *= 0.9;
  }
  
  
  //COLLISION DETECTION
  
  if (player.x < enemy.x + enemy.width &&
   player.x + player.width > enemy.x &&
   player.y < enemy.y + enemy.height &&
   player.y + player.height > enemy.y) {
    
   enemy.x_velocity -= 5;
   enemy.y_velocity -= 5;
   player.x_velocity += 5;
   player.y_velocity -= 5;
   if (player.imunity === false){
    player.health -= enemy.damage;
    player.imunity = true;
    console.log(player.health)
    setTimeout(playerImunity, player.imunityLength)
    function playerImunity() {
    player.imunity = false;
    }
   }
}
  
   
   if (player.health === 0) {
    window.alert('YOU DIED')
    location.reload();
   }
   
   
 
 
  
 c.clearRect(0,0, canvas.width, canvas.height);
 player.draw();
 enemy.draw();
  
  window.requestAnimationFrame(animation);
 }
  
 

 
 
 
 
 
 window.requestAnimationFrame(animation);
  window.addEventListener('keydown', controller.keyListener);
  window.addEventListener('keyup', controller.keyListener);  
  
  
  </script>
  
